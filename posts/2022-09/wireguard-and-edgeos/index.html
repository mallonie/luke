<!doctype html><html lang=en dir=auto><head><meta charset=utf-8><meta http-equiv=x-ua-compatible content="IE=edge"><meta name=viewport content="width=device-width,initial-scale=1,shrink-to-fit=no"><meta name=robots content="index, follow"><title>WireGuard and EdgeOS | Luke Mallon</title><meta name=keywords content="wireguard,vpn,router,ubiquity,ui,unifi,edgeos,edge router 12p,edge router"><meta name=description content="Install and setup WireGuard on EdgeOS"><meta name=author content="Luke Mallon"><link rel=canonical href=https://luke.mallon.ie/posts/2022-09/wireguard-and-edgeos/><link crossorigin=anonymous href=/assets/css/stylesheet.f61a7511732301667069ab149d1ebda8980e99bdf87f31d07f6343581c56568c.css integrity="sha256-9hp1EXMjAWZwaasUnR69qJgOmb34fzHQf2NDWBxWVow=" rel="preload stylesheet" as=style><script defer crossorigin=anonymous src=/assets/js/highlight.f413e19d0714851f6474e7ee9632408e58ac146fbdbe62747134bea2fa3415e0.js integrity="sha256-9BPhnQcUhR9kdOfuljJAjlisFG+9vmJ0cTS+ovo0FeA=" onload=hljs.initHighlightingOnLoad()></script>
<link rel=icon href=https://luke.mallon.ie/favicon.ico><link rel=icon type=image/png sizes=16x16 href=https://luke.mallon.ie/favicon-16x16.png><link rel=icon type=image/png sizes=32x32 href=https://luke.mallon.ie/favicon-32x32.png><link rel=apple-touch-icon href=https://luke.mallon.ie/apple-touch-icon.png><link rel=mask-icon href=https://luke.mallon.ie/safari-pinned-tab.svg><meta name=theme-color content="#2e2e33"><meta name=msapplication-TileColor content="#2e2e33"><noscript><style>#theme-toggle,.top-link{display:none}</style></noscript><meta property="og:title" content="WireGuard and EdgeOS"><meta property="og:description" content="Install and setup WireGuard on EdgeOS"><meta property="og:type" content="article"><meta property="og:url" content="https://luke.mallon.ie/posts/2022-09/wireguard-and-edgeos/"><meta property="article:section" content="posts"><meta property="article:published_time" content="2022-09-08T00:00:00+00:00"><meta property="article:modified_time" content="2022-09-08T00:00:00+00:00"><meta property="og:site_name" content="Luke Mallon"><meta name=twitter:card content="summary"><meta name=twitter:title content="WireGuard and EdgeOS"><meta name=twitter:description content="Install and setup WireGuard on EdgeOS"><script type=application/ld+json>{"@context":"https://schema.org","@type":"BreadcrumbList","itemListElement":[{"@type":"ListItem","position":1,"name":"Posts","item":"https://luke.mallon.ie/posts/"},{"@type":"ListItem","position":2,"name":"WireGuard and EdgeOS","item":"https://luke.mallon.ie/posts/2022-09/wireguard-and-edgeos/"}]}</script><script type=application/ld+json>{"@context":"https://schema.org","@type":"BlogPosting","headline":"WireGuard and EdgeOS","name":"WireGuard and EdgeOS","description":"Install and setup WireGuard on EdgeOS","keywords":["wireguard","vpn","router","ubiquity","ui","unifi","edgeos","edge router 12p","edge router"],"articleBody":"Background I spent some time over the last few weeks getting a start on my home network and removing the ISP provided Router from the network (putting it into modem mode), so it only passes the internet to my router and does nothing else.\nI previously had bought a UISP EdgeRouter 12P from Ubiquity, it has been a good Router so far. The documentation around EdgeOS could be better, it gives commands to run to make changes to the configuration but doesn’t always describe what each of the fields are or how they relate. Maybe this is something I should come to EdgeOS already knowing, as this seems like a bit of hardward that is intended for network specialists perhaps? I’m not sure.\nSo let’s get to the meat of this. I’ve been setting up the network with this router and a PiHole in order to have all devices on the network use this self hosted DNS so that I can block domains. I will probably document this in another post. With that setup I wanted to expand this and protect any devices that I bring out of the home e.g. phone, laptop, etc…\nEdgeOS The EdgeOS system has a web interface that allows you to configure all the things, it is a decent interface and I’ve been able to work my way around it for the most part. It does have built in support for PPTP Remote Access and IPsec Site-to-Site, but I don’t know the details of these and they seem like a bit much for setting up on a phone and laptop.\nEnter WireGuard So I was aware of WireGuard as a VPN from a friend, he had done a similar setup with his network and used WireGuard. So I had a look around to see what was available if anything. Thankfully the community has provided for this: WireGuard/wireguard-vyatta-ubnt.\nThis project supplies the required .deb file to install wireguard on the ER12P using the E300 release. This has support for the ER4, ER6P and ER12. I took the chance that the ER12P and the ER12 were not so disimilar as to break the package. So far this has held true.\nInstalling WireGuard In order to install WireGuard you will need to be able to ssh onto the Router. You should be able to use the default login details or, if you created your own user and deleted the default, you should be able to use your user details.\n❯ ssh user@router _____ _ | ____|__| | __ _ ___ (c) 2010-2020 | _| / _ |/ _ |/ _ \\ Ubiquiti Networks, Inc. | |__| (_| | (_| | __/ |_____\\__._|\\__. |\\___| https://www.ubnt.com |___/ Welcome to EdgeOS By logging in, accessing, or using the Ubiquiti product, you acknowledge that you have read and understood the Ubiquiti License Agreement (available in the Web UI at, by default, http://192.168.1.1) and agree to be bound by its terms. user@router password: Linux er12p 4.9.79-UBNT #1 SMP Thu Jun 30 07:03:20 UTC 2022 mips64 Welcome to EdgeOS user@router:~$ The previously linked install guide describes what is needed in order to install and setup WireGuard on EdgeOS. I will outline some of that here. First thing we need to do is download and install the .deb package, replacing the envvar values as required:\nuser@router:~$ export RELEASE=1.0.20220627 BOARD=e300-v2 MODULE=1.0.20210914 user@router:~$ curl -OL https://github.com/WireGuard/wireguard-vyatta-ubnt/releases/download/${RELEASE}-1/${BOARD}-v${RELEASE}-v${MODULE}.deb user@router:~$ sudo dpkg -i ${BOARD}-v${RELEASE}-v${MODULE}.deb Configuring WireGuard and EdgeOS We are now installed and can configure WireGuard to allow connections from clients. These clients are identified by a private and public key pair, the public key is used as part of the configuration, which we will go through now. First let’s setup the key pair for our Router:\nuser@router:~$ wg genkey | tee /config/auth/wg.key | wg pubkey \u003e /config/auth/wg.public With this keypair we can now setup the config for WireGuard in EdgeOS. We’ll need to enter the configure mode, run a few set commands and finally commit, save and exit:\nuser@router:~$ configure # Let's set the address subent for the wireguard interface wg0 # The IP in the subnet is where the router will live for this subnet, in this # example that is 192.168.2.1 user@router:~$ set interfaces wireguard wg0 address 192.168.2.1/24 # This is the port wireguard is listening on user@router:~$ set interfaces wireguard wg0 listen-port 51820 user@router:~$ set interfaces wireguard wg0 route-allowed-ips true # We also need to set the private key we generated as part of this interface user@router:~$ set interfaces wireguard wg0 private-key /config/auth/wg.key # We need to allow access to the WireGuard Interface port in our Firewall, make # sure to set $RULE_NUMBER to something that does not conflict with an existing # rule or it will be over written user@router:~$ set firewall name WAN_LOCAL rule $RULE_NUMBER action accept user@router:~$ set firewall name WAN_LOCAL rule $RULE_NUMBER protocol udp user@router:~$ set firewall name WAN_LOCAL rule $RULE_NUMBER description \"WireGuard VPN\" user@router:~$ set firewall name WAN_LOCAL rule $RULE_NUMBER destination port 51820 # Finally let's save all these changes user@router:~$ commit user@router:~$ save user@router:~$ exit Now that WireGuard is setup on the Router we should add our first client, to do this we’ll need to get the public key from a client. If you don’t already have one we’ll need to create one. I’ll work with the Android app here, we’ll create a new WireGuard tunnel:\nSo we’re creating a new Tunnel with the name home-network, creating a Private and Public key, setting the IP Address that this client will have 192.168.2.100/32 and if you have your own DNS Server, such as a pi-hole you can set the IP address for that in here. Next you will want to copy the Public key and create an entry for this in your Router config, this can be done as follows:\nuser@router:~$ configure # Now we're going to add our first client device. This device will be able # to connet to the internal network from outside by establishing a VPN connection # to the Public IP with the above listen-port. Replace $PUBLIC_KEY_ID with the # public key for your client device e.g. kaxZYUOQZVPpu/rhiUK0Rc2L3DWGld7omTu6ZhOGk3Y= user@router:~$ set interfaces wireguard wg0 peer $PUBLIC_KEY_ID description \"My Phone when outside\" user@router:~$ set interfaces wireguard wg0 peer $PUBLIC_KEY_ID allowed-ips 192.168.2.100/32 # And save changes user@router:~$ commit user@router:~$ save user@router:~$ exit Finally on our client device we need to setup a Peer which will be the Router. For this we’ll need the Public IP (or a domain if you have one associated with your public ip) and the Port we’ve setup WireGuard to use.\nSo enter the public key you generated earlier when setting up the router: /config/auth/wg.public Then enter the Public IP (or domain) and Port in the Endpoint field and finally set the Allowed IPs to the value you would like, if you want all traffic to run through your home network set this value to 0.0.0.0/0. You can also have IPv6 address run through this by adding , ::/0 to the field. Now all traffic will go through this connection. However you could limit this, if you instead only want traffic local to your home network to go through you can set this to a range that encompases this e.g. 192.168.0.0/16, now everything else will use your devices public connection for anything outside of this range.\nYou can get pretty complex with AllowedIPs and this website will help you to calculate the setting if you need more than a simple range.\nConclusion This is a great setup if you want to have access to your home-network while out and about. I’ve been using it now for few weeks and having this enabled and my DNS queries running thought the pi-hole, reducing the ads and tracking that generally follow you around the internet has been great. It’s also really useful to be able to access devices at home if needed, so far I have this on my phone, but I will be setting it up on my Laptop. So while I generally do not go out and use my laptop, with this setup I can see myself being a bit more likely to do that.\nI hope this has been of use, it’s good to have it documented here for myself.\n","wordCount":"1365","inLanguage":"en","datePublished":"2022-09-08T00:00:00Z","dateModified":"2022-09-08T00:00:00Z","author":[{"@type":"Person","name":"Luke Mallon"}],"mainEntityOfPage":{"@type":"WebPage","@id":"https://luke.mallon.ie/posts/2022-09/wireguard-and-edgeos/"},"publisher":{"@type":"Organization","name":"Luke Mallon","logo":{"@type":"ImageObject","url":"https://luke.mallon.ie/favicon.ico"}}}</script></head><body class=dark id=top><script>localStorage.getItem("pref-theme")==="light"&&document.body.classList.remove("dark")</script><header class=header><nav class=nav><div class=logo><a href=https://luke.mallon.ie/ accesskey=h title="Luke Mallon (Alt + H)">Luke Mallon</a><div class=logo-switches><button id=theme-toggle accesskey=t title="(Alt + T)"><svg id="moon" xmlns="http://www.w3.org/2000/svg" width="24" height="18" viewBox="0 0 24 24" fill="none" stroke="currentcolor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="M21 12.79A9 9 0 1111.21 3 7 7 0 0021 12.79z"/></svg><svg id="sun" xmlns="http://www.w3.org/2000/svg" width="24" height="18" viewBox="0 0 24 24" fill="none" stroke="currentcolor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><circle cx="12" cy="12" r="5"/><line x1="12" y1="1" x2="12" y2="3"/><line x1="12" y1="21" x2="12" y2="23"/><line x1="4.22" y1="4.22" x2="5.64" y2="5.64"/><line x1="18.36" y1="18.36" x2="19.78" y2="19.78"/><line x1="1" y1="12" x2="3" y2="12"/><line x1="21" y1="12" x2="23" y2="12"/><line x1="4.22" y1="19.78" x2="5.64" y2="18.36"/><line x1="18.36" y1="5.64" x2="19.78" y2="4.22"/></svg></button></div></div><ul id=menu><li><a href=https://luke.mallon.ie/about/ title=About><span>About</span></a></li><li><a href=https://luke.mallon.ie/archives/ title=Archives><span>Archives</span></a></li><li><a href=https://luke.mallon.ie/posts/ title=Posts><span>Posts</span></a></li><li><a href=https://luke.mallon.ie/search/ title="Search (Alt + /)" accesskey=/><span>Search</span></a></li><li><a href=https://luke.mallon.ie/tags/ title=Tags><span>Tags</span></a></li></ul></nav></header><main class=main><article class=post-single><header class=post-header><div class=breadcrumbs><a href=https://luke.mallon.ie/>Home</a>&nbsp;»&nbsp;<a href=https://luke.mallon.ie/posts/>Posts</a></div><h1 class=post-title>WireGuard and EdgeOS</h1><div class=post-description>Install and setup WireGuard on EdgeOS</div><div class=post-meta><span title='2022-09-08 00:00:00 +0000 UTC'>2022-09-08</span>&nbsp;·&nbsp;7 min&nbsp;·&nbsp;Luke Mallon</div></header><div class=toc><details><summary accesskey=c title="(Alt + C)"><span class=details>Table of Contents</span></summary><div class=inner><ul><li><a href=#background aria-label=Background>Background</a></li><li><a href=#edgeos aria-label=EdgeOS>EdgeOS</a><ul><li><a href=#enter-wireguard aria-label="Enter WireGuard">Enter WireGuard</a></li><li><a href=#installing-wireguard aria-label="Installing WireGuard">Installing WireGuard</a></li><li><a href=#configuring-wireguard-and-edgeos aria-label="Configuring WireGuard and EdgeOS">Configuring WireGuard and EdgeOS</a></li></ul></li><li><a href=#conclusion aria-label=Conclusion>Conclusion</a></li></ul></div></details></div><div class=post-content><h1 id=background>Background<a hidden class=anchor aria-hidden=true href=#background>#</a></h1><p>I spent some time over the last few weeks getting a start on my home network and
removing the ISP provided Router from the network (putting it into modem mode),
so it only passes the internet to my router and does nothing else.</p><p>I previously had bought a <a href=https://eu.store.ui.com/collections/operator-isp-infrastructure/products/edgerouter-12p>UISP EdgeRouter 12P</a>
from Ubiquity, it has been a good Router so far. The documentation around EdgeOS
could be better, it gives commands to run to make changes to the configuration
but doesn&rsquo;t always describe what each of the fields are or how they relate. Maybe
this is something I should come to EdgeOS already knowing, as this seems like a
bit of hardward that is intended for network specialists perhaps? I&rsquo;m not sure.</p><p>So let&rsquo;s get to the meat of this. I&rsquo;ve been setting up the network with this router
and a <a href=https://pi-hole.net>PiHole</a> in order to have all devices on the network
use this self hosted DNS so that I can block domains. I will probably document
this in another post. With that setup I wanted to expand this and protect any devices
that I bring out of the home e.g. phone, laptop, etc&mldr;</p><h1 id=edgeos>EdgeOS<a hidden class=anchor aria-hidden=true href=#edgeos>#</a></h1><p>The EdgeOS system has a web interface that allows you to configure all the things,
it is a decent interface and I&rsquo;ve been able to work my way around it for the most
part. It does have built in support for PPTP Remote Access and IPsec Site-to-Site,
but I don&rsquo;t know the details of these and they seem like a bit much for setting
up on a phone and laptop.</p><h2 id=enter-wireguard>Enter WireGuard<a hidden class=anchor aria-hidden=true href=#enter-wireguard>#</a></h2><p>So I was aware of WireGuard as a VPN from a friend, he had done a similar setup
with his network and used WireGuard. So I had a look around to see what was available
if anything. Thankfully the community has provided for this: <a href=https://github.com/WireGuard/wireguard-vyatta-ubnt>WireGuard/wireguard-vyatta-ubnt</a>.</p><p>This project supplies the required <code>.deb</code> file to <a href=https://github.com/WireGuard/wireguard-vyatta-ubnt/wiki/EdgeOS-and-Unifi-Gateway>install wireguard on the ER12P</a>
using the <code>E300</code> release. This has support for the ER4, ER6P and ER12. I took the
chance that the ER12P and the ER12 were not so disimilar as to break the package.
So far this has held true.</p><h2 id=installing-wireguard>Installing WireGuard<a hidden class=anchor aria-hidden=true href=#installing-wireguard>#</a></h2><p>In order to install WireGuard you will need to be able to ssh onto the Router.
You should be able to use the default login details or, if you created your own
user and deleted the default, you should be able to use your user details.</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-bash data-lang=bash><span style=display:flex><span>❯ ssh user@router
</span></span><span style=display:flex><span>  _____    _
</span></span><span style=display:flex><span> | ____|__| | __ _  ___          <span style=color:#f92672>(</span>c<span style=color:#f92672>)</span> 2010-2020
</span></span><span style=display:flex><span> |  _| / _  |/ _  |/ _ <span style=color:#ae81ff>\ </span>        Ubiquiti Networks, Inc.
</span></span><span style=display:flex><span> | |__| <span style=color:#f92672>(</span>_| | <span style=color:#f92672>(</span>_| |  __/
</span></span><span style=display:flex><span> |_____<span style=color:#ae81ff>\_</span>_._|<span style=color:#ae81ff>\_</span>_. |<span style=color:#ae81ff>\_</span>__|         https://www.ubnt.com
</span></span><span style=display:flex><span>             |___/
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>Welcome to EdgeOS
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>By logging in, accessing, or using the Ubiquiti product, you
</span></span><span style=display:flex><span>acknowledge that you have read and understood the Ubiquiti
</span></span><span style=display:flex><span>License Agreement <span style=color:#f92672>(</span>available in the Web UI at, by default,
</span></span><span style=display:flex><span>http://192.168.1.1<span style=color:#f92672>)</span> and agree to be bound by its terms.
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>user@router password: 
</span></span><span style=display:flex><span>Linux er12p 4.9.79-UBNT <span style=color:#75715e>#1 SMP Thu Jun 30 07:03:20 UTC 2022 mips64</span>
</span></span><span style=display:flex><span>Welcome to EdgeOS
</span></span><span style=display:flex><span>user@router:~$
</span></span></code></pre></div><p>The previously linked <a href=https://github.com/WireGuard/wireguard-vyatta-ubnt/wiki/EdgeOS-and-Unifi-Gateway>install guide</a>
describes what is needed in order to install and setup WireGuard on EdgeOS. I
will outline some of that here. First thing we need to do is download and install
the <code>.deb</code> package, replacing the envvar values as required:</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-bash data-lang=bash><span style=display:flex><span>user@router:~$ export RELEASE<span style=color:#f92672>=</span>1.0.20220627 BOARD<span style=color:#f92672>=</span>e300-v2 MODULE<span style=color:#f92672>=</span>1.0.20210914
</span></span><span style=display:flex><span>user@router:~$ curl -OL https://github.com/WireGuard/wireguard-vyatta-ubnt/releases/download/<span style=color:#e6db74>${</span>RELEASE<span style=color:#e6db74>}</span>-1/<span style=color:#e6db74>${</span>BOARD<span style=color:#e6db74>}</span>-v<span style=color:#e6db74>${</span>RELEASE<span style=color:#e6db74>}</span>-v<span style=color:#e6db74>${</span>MODULE<span style=color:#e6db74>}</span>.deb
</span></span><span style=display:flex><span>user@router:~$ sudo dpkg -i <span style=color:#e6db74>${</span>BOARD<span style=color:#e6db74>}</span>-v<span style=color:#e6db74>${</span>RELEASE<span style=color:#e6db74>}</span>-v<span style=color:#e6db74>${</span>MODULE<span style=color:#e6db74>}</span>.deb
</span></span></code></pre></div><h2 id=configuring-wireguard-and-edgeos>Configuring WireGuard and EdgeOS<a hidden class=anchor aria-hidden=true href=#configuring-wireguard-and-edgeos>#</a></h2><p>We are now installed and can configure WireGuard to allow connections from clients.
These clients are identified by a private and public key pair, the public key is
used as part of the configuration, which we will go through now. First let&rsquo;s setup
the key pair for our Router:</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-bash data-lang=bash><span style=display:flex><span>user@router:~$ wg genkey | tee /config/auth/wg.key | wg pubkey &gt; /config/auth/wg.public
</span></span></code></pre></div><p>With this keypair we can now setup the config for WireGuard in EdgeOS. We&rsquo;ll need
to enter the <code>configure</code> mode, run a few <code>set</code> commands and finally <code>commit</code>, <code>save</code>
and <code>exit</code>:</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-bash data-lang=bash><span style=display:flex><span>user@router:~$ configure
</span></span><span style=display:flex><span><span style=color:#75715e># Let&#39;s set the address subent for the wireguard interface wg0</span>
</span></span><span style=display:flex><span><span style=color:#75715e># The IP in the subnet is where the router will live for this subnet, in this</span>
</span></span><span style=display:flex><span><span style=color:#75715e># example that is 192.168.2.1</span>
</span></span><span style=display:flex><span>user@router:~$ set interfaces wireguard wg0 address 192.168.2.1/24
</span></span><span style=display:flex><span><span style=color:#75715e># This is the port wireguard is listening on</span>
</span></span><span style=display:flex><span>user@router:~$ set interfaces wireguard wg0 listen-port <span style=color:#ae81ff>51820</span>
</span></span><span style=display:flex><span>user@router:~$ set interfaces wireguard wg0 route-allowed-ips true
</span></span><span style=display:flex><span><span style=color:#75715e># We also need to set the private key we generated as part of this interface</span>
</span></span><span style=display:flex><span>user@router:~$ set interfaces wireguard wg0 private-key /config/auth/wg.key
</span></span><span style=display:flex><span><span style=color:#75715e># We need to allow access to the WireGuard Interface port in our Firewall, make</span>
</span></span><span style=display:flex><span><span style=color:#75715e># sure to set $RULE_NUMBER to something that does not conflict with an existing</span>
</span></span><span style=display:flex><span><span style=color:#75715e># rule or it will be over written</span>
</span></span><span style=display:flex><span>user@router:~$ set firewall name WAN_LOCAL rule $RULE_NUMBER action accept
</span></span><span style=display:flex><span>user@router:~$ set firewall name WAN_LOCAL rule $RULE_NUMBER protocol udp
</span></span><span style=display:flex><span>user@router:~$ set firewall name WAN_LOCAL rule $RULE_NUMBER description <span style=color:#e6db74>&#34;WireGuard VPN&#34;</span>
</span></span><span style=display:flex><span>user@router:~$ set firewall name WAN_LOCAL rule $RULE_NUMBER destination port <span style=color:#ae81ff>51820</span>
</span></span><span style=display:flex><span><span style=color:#75715e># Finally let&#39;s save all these changes</span>
</span></span><span style=display:flex><span>user@router:~$ commit
</span></span><span style=display:flex><span>user@router:~$ save
</span></span><span style=display:flex><span>user@router:~$ exit
</span></span></code></pre></div><p>Now that WireGuard is setup on the Router we should add our first client, to do
this we&rsquo;ll need to get the public key from a client. If you don&rsquo;t already have
one we&rsquo;ll need to create one. I&rsquo;ll work with the Android app here, we&rsquo;ll create
a new WireGuard tunnel:</p><p><img loading=lazy src=/images/wireguard-android.jpg alt="Create WireGuard Tunnel" title="Create WireGuard Tunnel - Android App"></p><p>So we&rsquo;re creating a new Tunnel with the name <code>home-network</code>, creating a Private
and Public key, setting the IP Address that this client will have <code>192.168.2.100/32</code>
and if you have your own DNS Server, such as a <a href=https://pi-hole.net>pi-hole</a> you
can set the IP address for that in here. Next you will want to copy the Public key
and create an entry for this in your Router config, this can be done as follows:</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-bash data-lang=bash><span style=display:flex><span>user@router:~$ configure
</span></span><span style=display:flex><span><span style=color:#75715e># Now we&#39;re going to add our first client device. This device will be able</span>
</span></span><span style=display:flex><span><span style=color:#75715e># to connet to the internal network from outside by establishing a VPN connection</span>
</span></span><span style=display:flex><span><span style=color:#75715e># to the Public IP with the above listen-port. Replace $PUBLIC_KEY_ID with the</span>
</span></span><span style=display:flex><span><span style=color:#75715e># public key for your client device e.g. kaxZYUOQZVPpu/rhiUK0Rc2L3DWGld7omTu6ZhOGk3Y=</span>
</span></span><span style=display:flex><span>user@router:~$ set interfaces wireguard wg0 peer $PUBLIC_KEY_ID description <span style=color:#e6db74>&#34;My Phone when outside&#34;</span>
</span></span><span style=display:flex><span>user@router:~$ set interfaces wireguard wg0 peer $PUBLIC_KEY_ID allowed-ips 192.168.2.100/32
</span></span><span style=display:flex><span><span style=color:#75715e># And save changes</span>
</span></span><span style=display:flex><span>user@router:~$ commit
</span></span><span style=display:flex><span>user@router:~$ save
</span></span><span style=display:flex><span>user@router:~$ exit
</span></span></code></pre></div><p>Finally on our client device we need to setup a Peer which will be the Router.
For this we&rsquo;ll need the Public IP (or a domain if you have one associated with
your public ip) and the Port we&rsquo;ve setup WireGuard to use.</p><p><img loading=lazy src=/images/wireguard-android-peer.jpg alt="WireGuard Tunner Peer" title="WireGuard Tunnel Peer - Android App"></p><p>So enter the public key you generated earlier when setting up the router: <code>/config/auth/wg.public</code>
Then enter the Public IP (or domain) and Port in the <code>Endpoint</code> field and finally
set the <code>Allowed IPs</code> to the value you would like, if you want all traffic to
run through your home network set this value to <code>0.0.0.0/0</code>. You can also have IPv6
address run through this by adding <code>, ::/0</code> to the field. Now all traffic will
go through this connection. However you could limit this, if you instead only
want traffic local to your home network to go through you can set this to a range
that encompases this e.g. <code>192.168.0.0/16</code>, now everything else will use your
devices public connection for anything outside of this range.</p><p>You can get pretty complex with <code>AllowedIPs</code> and <a href=https://www.procustodibus.com/blog/2021/03/wireguard-allowedips-calculator/>this website</a>
will help you to calculate the setting if you need more than a simple range.</p><h1 id=conclusion>Conclusion<a hidden class=anchor aria-hidden=true href=#conclusion>#</a></h1><p>This is a great setup if you want to have access to your home-network while out
and about. I&rsquo;ve been using it now for few weeks and having this enabled and my
DNS queries running thought the <a href=https://pi-hole.net>pi-hole</a>, reducing the ads
and tracking that generally follow you around the internet has been great. It&rsquo;s
also really useful to be able to access devices at home if needed, so far I have
this on my phone, but I will be setting it up on my Laptop. So while I generally
do not go out and use my laptop, with this setup I can see myself being a bit
more likely to do that.</p><p>I hope this has been of use, it&rsquo;s good to have it documented here for myself.</p></div><footer class=post-footer><ul class=post-tags><li><a href=https://luke.mallon.ie/tags/wireguard/>wireguard</a></li><li><a href=https://luke.mallon.ie/tags/vpn/>vpn</a></li><li><a href=https://luke.mallon.ie/tags/router/>router</a></li><li><a href=https://luke.mallon.ie/tags/ubiquity/>ubiquity</a></li><li><a href=https://luke.mallon.ie/tags/ui/>ui</a></li><li><a href=https://luke.mallon.ie/tags/unifi/>unifi</a></li><li><a href=https://luke.mallon.ie/tags/edgeos/>edgeos</a></li><li><a href=https://luke.mallon.ie/tags/edge-router-12p/>edge router 12p</a></li><li><a href=https://luke.mallon.ie/tags/edge-router/>edge router</a></li></ul><nav class=paginav><a class=prev href=https://luke.mallon.ie/posts/2022-09/passwords/><span class=title>« Prev</span><br><span>Passwords</span></a></nav><div class=share-buttons><a target=_blank rel="noopener noreferrer" aria-label="share WireGuard and EdgeOS on twitter" href="https://twitter.com/intent/tweet/?text=WireGuard%20and%20EdgeOS&url=https%3a%2f%2fluke.mallon.ie%2fposts%2f2022-09%2fwireguard-and-edgeos%2f&hashtags=wireguard%2cvpn%2crouter%2cubiquity%2cui%2cunifi%2cedgeos%2cedgerouter12p%2cedgerouter"><svg viewBox="0 0 512 512" height="30" width="30" fill="currentcolor"><path d="M449.446.0C483.971.0 512 28.03 512 62.554v386.892C512 483.97 483.97 512 449.446 512H62.554c-34.524.0-62.554-28.03-62.554-62.554V62.554c0-34.524 28.029-62.554 62.554-62.554h386.892zM195.519 424.544c135.939.0 210.268-112.643 210.268-210.268.0-3.218.0-6.437-.153-9.502 14.406-10.421 26.973-23.448 36.935-38.314-13.18 5.824-27.433 9.809-42.452 11.648 15.326-9.196 26.973-23.602 32.49-40.92-14.252 8.429-30.038 14.56-46.896 17.931-13.487-14.406-32.644-23.295-53.946-23.295-40.767.0-73.87 33.104-73.87 73.87.0 5.824.613 11.494 1.992 16.858-61.456-3.065-115.862-32.49-152.337-77.241-6.284 10.881-9.962 23.601-9.962 37.088.0 25.594 13.027 48.276 32.95 61.456-12.107-.307-23.448-3.678-33.41-9.196v.92c0 35.862 25.441 65.594 59.311 72.49-6.13 1.686-12.72 2.606-19.464 2.606-4.751.0-9.348-.46-13.946-1.38 9.349 29.426 36.628 50.728 68.965 51.341-25.287 19.771-57.164 31.571-91.8 31.571-5.977.0-11.801-.306-17.625-1.073 32.337 21.15 71.264 33.41 112.95 33.41z"/></svg></a><a target=_blank rel="noopener noreferrer" aria-label="share WireGuard and EdgeOS on linkedin" href="https://www.linkedin.com/shareArticle?mini=true&url=https%3a%2f%2fluke.mallon.ie%2fposts%2f2022-09%2fwireguard-and-edgeos%2f&title=WireGuard%20and%20EdgeOS&summary=WireGuard%20and%20EdgeOS&source=https%3a%2f%2fluke.mallon.ie%2fposts%2f2022-09%2fwireguard-and-edgeos%2f"><svg viewBox="0 0 512 512" height="30" width="30" fill="currentcolor"><path d="M449.446.0C483.971.0 512 28.03 512 62.554v386.892C512 483.97 483.97 512 449.446 512H62.554c-34.524.0-62.554-28.03-62.554-62.554V62.554c0-34.524 28.029-62.554 62.554-62.554h386.892zM160.461 423.278V197.561h-75.04v225.717h75.04zm270.539.0V293.839c0-69.333-37.018-101.586-86.381-101.586-39.804.0-57.634 21.891-67.617 37.266v-31.958h-75.021c.995 21.181.0 225.717.0 225.717h75.02V297.222c0-6.748.486-13.492 2.474-18.315 5.414-13.475 17.767-27.434 38.494-27.434 27.135.0 38.007 20.707 38.007 51.037v120.768H431zM123.448 88.722C97.774 88.722 81 105.601 81 127.724c0 21.658 16.264 39.002 41.455 39.002h.484c26.165.0 42.452-17.344 42.452-39.002-.485-22.092-16.241-38.954-41.943-39.002z"/></svg></a><a target=_blank rel="noopener noreferrer" aria-label="share WireGuard and EdgeOS on reddit" href="https://reddit.com/submit?url=https%3a%2f%2fluke.mallon.ie%2fposts%2f2022-09%2fwireguard-and-edgeos%2f&title=WireGuard%20and%20EdgeOS"><svg viewBox="0 0 512 512" height="30" width="30" fill="currentcolor"><path d="M449.446.0C483.971.0 512 28.03 512 62.554v386.892C512 483.97 483.97 512 449.446 512H62.554c-34.524.0-62.554-28.03-62.554-62.554V62.554c0-34.524 28.029-62.554 62.554-62.554h386.892zM446 265.638c0-22.964-18.616-41.58-41.58-41.58-11.211.0-21.361 4.457-28.841 11.666-28.424-20.508-67.586-33.757-111.204-35.278l18.941-89.121 61.884 13.157c.756 15.734 13.642 28.29 29.56 28.29 16.407.0 29.706-13.299 29.706-29.701.0-16.403-13.299-29.702-29.706-29.702-11.666.0-21.657 6.792-26.515 16.578l-69.105-14.69c-1.922-.418-3.939-.042-5.585 1.036-1.658 1.073-2.811 2.761-3.224 4.686l-21.152 99.438c-44.258 1.228-84.046 14.494-112.837 35.232-7.468-7.164-17.589-11.591-28.757-11.591-22.965.0-41.585 18.616-41.585 41.58.0 16.896 10.095 31.41 24.568 37.918-.639 4.135-.99 8.328-.99 12.576.0 63.977 74.469 115.836 166.33 115.836s166.334-51.859 166.334-115.836c0-4.218-.347-8.387-.977-12.493 14.564-6.47 24.735-21.034 24.735-38.001zM326.526 373.831c-20.27 20.241-59.115 21.816-70.534 21.816-11.428.0-50.277-1.575-70.522-21.82-3.007-3.008-3.007-7.882.0-10.889 3.003-2.999 7.882-3.003 10.885.0 12.777 12.781 40.11 17.317 59.637 17.317 19.522.0 46.86-4.536 59.657-17.321 3.016-2.999 7.886-2.995 10.885.008 3.008 3.011 3.003 7.882-.008 10.889zm-5.23-48.781c-16.373.0-29.701-13.324-29.701-29.698.0-16.381 13.328-29.714 29.701-29.714 16.378.0 29.706 13.333 29.706 29.714.0 16.374-13.328 29.698-29.706 29.698zM160.91 295.348c0-16.381 13.328-29.71 29.714-29.71 16.369.0 29.689 13.329 29.689 29.71.0 16.373-13.32 29.693-29.689 29.693-16.386.0-29.714-13.32-29.714-29.693z"/></svg></a></div></footer><script src=https://utteranc.es/client.js repo=mallonie/luke issue-term=pathname label=post-comment theme=preferred-color-scheme crossorigin=anonymous async></script></article></main><footer class=footer><span>&copy; 2023 <a href=https://luke.mallon.ie/>Luke Mallon</a></span>
<span>Powered by
<a href=https://gohugo.io/ rel="noopener noreferrer" target=_blank>Hugo</a> &
        <a href=https://github.com/adityatelange/hugo-PaperMod/ rel=noopener target=_blank>PaperMod</a></span></footer><a href=#top aria-label="go to top" title="Go to Top (Alt + G)" class=top-link id=top-link accesskey=g><svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 12 6" fill="currentcolor"><path d="M12 6H0l6-6z"/></svg></a><script>let menu=document.getElementById("menu");menu&&(menu.scrollLeft=localStorage.getItem("menu-scroll-position"),menu.onscroll=function(){localStorage.setItem("menu-scroll-position",menu.scrollLeft)}),document.querySelectorAll('a[href^="#"]').forEach(e=>{e.addEventListener("click",function(e){e.preventDefault();var t=this.getAttribute("href").substr(1);window.matchMedia("(prefers-reduced-motion: reduce)").matches?document.querySelector(`[id='${decodeURIComponent(t)}']`).scrollIntoView():document.querySelector(`[id='${decodeURIComponent(t)}']`).scrollIntoView({behavior:"smooth"}),t==="top"?history.replaceState(null,null," "):history.pushState(null,null,`#${t}`)})})</script><script>var mybutton=document.getElementById("top-link");window.onscroll=function(){document.body.scrollTop>800||document.documentElement.scrollTop>800?(mybutton.style.visibility="visible",mybutton.style.opacity="1"):(mybutton.style.visibility="hidden",mybutton.style.opacity="0")}</script><script>document.getElementById("theme-toggle").addEventListener("click",()=>{document.body.className.includes("dark")?(document.body.classList.remove("dark"),localStorage.setItem("pref-theme","light")):(document.body.classList.add("dark"),localStorage.setItem("pref-theme","dark"))})</script><script>document.querySelectorAll("pre > code").forEach(e=>{const n=e.parentNode.parentNode,t=document.createElement("button");t.classList.add("copy-code"),t.innerHTML="copy";function s(){t.innerHTML="copied!",setTimeout(()=>{t.innerHTML="copy"},2e3)}t.addEventListener("click",t=>{if("clipboard"in navigator){navigator.clipboard.writeText(e.textContent),s();return}const n=document.createRange();n.selectNodeContents(e);const o=window.getSelection();o.removeAllRanges(),o.addRange(n);try{document.execCommand("copy"),s()}catch{}o.removeRange(n)}),n.classList.contains("highlight")?n.appendChild(t):n.parentNode.firstChild==n||(e.parentNode.parentNode.parentNode.parentNode.parentNode.nodeName=="TABLE"?e.parentNode.parentNode.parentNode.parentNode.parentNode.appendChild(t):e.parentNode.appendChild(t))})</script></body></html>